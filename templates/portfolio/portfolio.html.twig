{% extends 'base.html.twig' %}

{% block title %}Portfolio{% endblock %}


{% block javascripts %}
    {{ parent() }}
    {#{{ encore_entry_script_tags('portfolio') }}#}
{% endblock %}

{% block body %}
<div class="portfolio-container">
    <h1>{{portfolio.name}}</h1>

    <ul class="portfolio-container__nav">
        <li>
            <a href="{{ path('app_dashboard') }}">Back to Dashboard</a>
        </li>
    </ul>

    <div class="portfolio-container__portfolio-details">
        <h2>Portfolio Details</h2>
        <table class="portfolio-container__portfolio-details__details">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Total amount</th>
                    <th>Change</th>
                    <th>Change %</th>
                    <th>Actual value</th>
                    <th>Creation date</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{portfolio.name}}</td>
                    <td>
                        {{total}} {{app.user.balance.currency.value}}
                    </td>
                    <td style="color: {{actual >= total ? "green" : "red"}};">
                        {% if actual >= total %}
                            <i class="fas fa-arrow-up"></i>
                            {{(actual - total)|number_format(2, '.', ',')}}
                        {% else %}
                            <i class="fas fa-arrow-down"></i>
                            {{(total - actual)|number_format(2, '.', ',')}}
                        {% endif %}
                        {{app.user.balance.currency.value}}
                    </td>
                    <td style="color: {{actual >= total ? "green" : "red"}};">
                        {{((actual - total) / total * 100)|number_format(2, '.', ',')}} %
                    </td>
                    <td>{{actual|number_format(2, '.', ',')}} {{app.user.balance.currency.value}}</td>
                    <td>{{portfolio.createdAt|date('m/d/Y')}}</td>
                </tr>
            </tbody>
        </table>
        <h2>Assets</h2>
        <ul class="portfolio-container__portfolio-details__asstes">
            {% if portfolio.assets|length > 0 %}
                {% for asset in portfolio.assets %}
                    <li>
                        <ul>
                            <li>Asset name: {{asset.name}}</li>
                            <li>Asset amount: {{asset.amount}}</li>
                            <li>Asset bought price: {{asset.boughtPrice|number_format(2, '.', ',')}} <b>{{app.user.balance.currency.value}}</b></li>
                            <li>Asset actual price: 
                                {% for newAsset in newData %}
                                    {% if newAsset.name == asset.name %}
                                        {{newAsset.price|number_format(2, '.', ',')}} <b>{{app.user.balance.currency.value}}</b>
                                    {% endif %}
                                {% endfor %}
                            <li>Asset bought date: {{asset.boughtAt|date('m/d/Y')}}</li>
                        </ul>
                    </li>
                {% endfor %}
            {% else %}
                <li>No assets</li>
            {% endif %}
        </ul>
    </div>

</div>
{% endblock %}
